<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#9e4b13" />
  <title>DEVOCEAN Lodge | Eco Beach Stays in Ponta do Ouro</title>

  <!-- Consent Mode v2 Defaults (MUST be FIRST script) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    // EU+UK = denied by default
    gtag('consent', 'default', {
      ad_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      analytics_storage: 'denied',
      functionality_storage: 'granted',
      personalization_storage: 'granted',
      security_storage: 'granted',
      region: [
        'AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT',
        'LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','IS','LI','NO','GB'
      ]
    });

    // Everywhere else = granted
    gtag('consent', 'default', {
      ad_storage: 'granted',
      ad_user_data: 'granted',
      ad_personalization: 'granted',
      analytics_storage: 'granted',
      functionality_storage: 'granted',
      personalization_storage: 'granted',
      security_storage: 'granted'
    });
  </script>

  <!-- Perf hints for tag loaders & external services -->
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://book.devoceanlodge.com">

  <!-- User Engagement Detection for GTM optimization -->
  <script>
    (function() {
      let engaged = false;
      let consentGranted = false;
      let marketingAllowedFired = false;
      
      function checkMarketingAllowed() {
        if (engaged && consentGranted && !marketingAllowedFired) {
          marketingAllowedFired = true;
          
          // Additional 3-second delay specifically for ads conversion tracking
          // This reduces main-thread blocking from Google Ads tags
          setTimeout(function() {
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
              event: 'marketing_allowed',
              timestamp: Date.now()
            });
          }, 3000);
        }
      }
      
      function fireEngagement() {
        if (engaged) return;
        engaged = true;
        
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
          event: 'user_engaged',
          engagement_type: 'interaction'
        });
        
        checkMarketingAllowed();
      }
      
      function checkConsentInItem(item) {
        if (!item || typeof item !== 'object') return false;
        
        // Normalize array-like objects (Arguments) to real arrays
        let normalized = item;
        if (!Array.isArray(item) && typeof item === 'object' && '0' in item) {
          // This is an Arguments object or array-like, convert to array
          try {
            normalized = Array.from(item);
          } catch (e) {
            normalized = Array.prototype.slice.call(item);
          }
        }
        
        // Handle gtag consent pushes: ['consent', 'default'/'update', {ad_storage: 'granted', ...}]
        if (Array.isArray(normalized) && normalized[0] === 'consent' && normalized[2]) {
          if (normalized[2].ad_storage === 'granted') {
            consentGranted = true;
            return true;
          }
        }
        // Handle object-based consent events: {event: 'consent', ad_storage: 'granted'}
        else if (!Array.isArray(item) && item.event) {
          if ((item.event === 'consent' || item.event === 'consent_update') && item.ad_storage === 'granted') {
            consentGranted = true;
            return true;
          }
        }
        return false;
      }
      
      // Initialize by scanning existing dataLayer entries
      window.dataLayer = window.dataLayer || [];
      for (let i = 0; i < window.dataLayer.length; i++) {
        if (checkConsentInItem(window.dataLayer[i])) {
          break; // Found granted consent, stop scanning
        }
      }
      
      // Intercept future dataLayer.push calls to detect consent updates
      const originalPush = window.dataLayer.push;
      window.dataLayer.push = function() {
        const args = Array.from(arguments);
        
        // Check each pushed item for consent
        args.forEach(function(item) {
          if (checkConsentInItem(item)) {
            checkMarketingAllowed();
          }
        });
        
        return originalPush.apply(window.dataLayer, args);
      };
      
      // Detect engagement via scroll (past 25% of page)
      let scrollFired = false;
      window.addEventListener('scroll', function() {
        if (scrollFired) return;
        const scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
        if (scrollPercent > 25) {
          scrollFired = true;
          fireEngagement();
        }
      }, { passive: true });
      
      // Detect engagement via any click
      document.addEventListener('click', fireEngagement, { once: true, passive: true });
      
      // Detect engagement via time on page (20 seconds)
      setTimeout(fireEngagement, 20000);
    })();
  </script>

  <!-- Google Tag Manager (GTM-532W3HH2) - Delayed 4s for performance -->
  <script>
    // Delay GTM loading by 4 seconds to improve initial page load
    setTimeout(function() {
      (function (w, d, s, l, i) {
        w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', 'GTM-532W3HH2');
    }, 4000);
  </script>
  <!-- End GTM -->

  <!-- reCAPTCHA v3 (lazy loaded when contact form visible) -->
  <script>
    window.RECAPTCHA_SITE_KEY = '6LdENtwrAAAAAPy6JsCXFJLR16ST1BnX-NyPDC7L';
    
    // Lazy loader for reCAPTCHA
    window.loadRecaptcha = (function() {
      let promise = null;
      
      return function() {
        if (promise) return promise;
        
        if (window.grecaptcha) {
          promise = Promise.resolve(window.grecaptcha);
          return promise;
        }
        
        promise = new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = 'https://www.google.com/recaptcha/api.js?render=' + window.RECAPTCHA_SITE_KEY;
          script.async = true;
          script.defer = true;
          script.onload = () => resolve(window.grecaptcha);
          script.onerror = () => reject(new Error('Failed to load reCAPTCHA'));
          document.head.appendChild(script);
        });
        
        return promise;
      };
    })();
  </script>
  <!-- SEO etc. -->
  <meta name="color-scheme" content="light dark" />
  <meta name="description"
    content="Eco-friendly beach accommodation in Ponta do Ouro, Mozambique. Safari tents, cottage & chalet near the beach. Family-run hospitality and great value." />
  <link rel="canonical" href="https://devoceanlodge.com/" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />

  <!-- Favicons / app icons -->
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#9e4b13">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DEVOCEAN Lodge | Ponta do Ouro, Mozambique" />
  <meta property="og:description"
    content="Eco-friendly stays near the beach. Tents, cottages and thatched chalets with warm, family-run hospitality." />
  <meta property="og:url" content="https://devoceanlodge.com/" />
  <meta property="og:image" content="https://devoceanlodge.com/photos/hero01.jpg" />
  <meta property="og:site_name" content="DEVOCEAN Lodge" />
  <meta property="og:locale" content="en_US" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="DEVOCEAN Lodge | Ponta do Ouro, Mozambique" />
  <meta name="twitter:description"
    content="Eco-friendly stays near the beach. Tents, cottages and thatched chalets with warm, family-run hospitality." />
  <meta name="twitter:image" content="https://devoceanlodge.com/photos/hero01.jpg" />

  <!-- Hint the hero for faster LCP (WebP with responsive) -->
  <link rel="preload" as="image" href="/photos/hero01.webp" type="image/webp" imagesrcset="/photos/hero01-mobile.webp 800w, /photos/hero01.webp 1335w" imagesizes="100vw" fetchpriority="high" />
  <link rel="preload" as="image" href="/photos/hero01.jpg" imagesrcset="/photos/hero01-mobile.jpg 800w, /photos/hero01.jpg 1335w" imagesizes="100vw" fetchpriority="high" />

  <!-- JSON-LD (valid JSON) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": ["LodgingBusiness","Hotel"],
    "@id": "https://devoceanlodge.com/#lodge",
    "name": "DEVOCEAN Lodge",
    "brand": { "@type": "Brand", "name": "TERRAfrique LDA" },
    "url": "https://devoceanlodge.com/",
    "logo": "https://devoceanlodge.com/images/Logo2.png",
    "image": [
      "https://devoceanlodge.com/photos/hero01.jpg",
      "https://devoceanlodge.com/photos/hero02.jpg",
      "https://devoceanlodge.com/photos/hero03.jpg",
      "https://devoceanlodge.com/photos/hero04.jpg",
      "https://devoceanlodge.com/photos/hero05.jpg"
    ],
    "description": "Eco-friendly lodge in Ponta do Ouro, Southern Mozambique â€” safari tents, thatched chalet and garden cottage a few minutes from the beach.",
    "email": "info@devoceanlodge.com",
    "telephone": "+258 84 418 2252",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Rua C, parcela 12, 1118",
      "addressLocality": "Ponta do Ouro",
      "addressRegion": "Matutuine",
      "postalCode": "1118",
      "addressCountry": "MZ"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": -26.841994852732736,
      "longitude": 32.88504331196165
    },
    "hasMap": "https://www.google.com/maps?q=-26.841994852732736,32.88504331196165&z=13&output=embed",
    "checkinTime": "14:00",
    "checkoutTime": "10:00",
    "priceRange": "$$",
    "petsAllowed": false,
    "amenityFeature": [
      { "@type": "LocationFeatureSpecification", "name": "Eco-friendly lodging", "value": true },
      { "@type": "LocationFeatureSpecification", "name": "Free high-speed Wi-Fi", "value": true },
      { "@type": "LocationFeatureSpecification", "name": "Breakfast available", "value": true }
    ],
    "availableLanguage": [
      { "@type": "Language", "name": "English", "alternateName": "en" },
      { "@type": "Language", "name": "Portuguese", "alternateName": "pt" },
      { "@type": "Language", "name": "Dutch", "alternateName": "nl" },
      { "@type": "Language", "name": "French", "alternateName": "fr" },
      { "@type": "Language", "name": "German", "alternateName": "de" }
    ],
    "areaServed": { "@type": "Country", "name": "Mozambique" },
    "sameAs": [
      "https://www.facebook.com/devoceanmz/",
      "https://www.instagram.com/devoceanmz/",
      "https://x.com/DEVOCEANMZ",
      "https://www.linkedin.com/company/devocean-lodge",
      "https://www.tiktok.com/@devoceanlodge",
      "https://www.pinterest.com/devoceansa/",
      "https://www.youtube.com/@DEVOCEAN_MZ"
    ],
    "potentialAction": {
      "@type": "ReserveAction",
      "target": { "@type": "EntryPoint", "urlTemplate": "https://book.devoceanlodge.com/bv3/search" },
      "result": { "@type": "LodgingReservation" }
    }
  }
  </script>

  <!-- Locale initializer: runs before React/Vite -->
  <script>
    (function () {
      try {
        var SUPPORTED = ["en", "pt", "nl", "fr", "it", "de", "es", "ptmz"];

        // read current state
        var src = localStorage.getItem("site.lang_source") || "auto";
        var curr = localStorage.getItem("site.currency") || null;
        var lang = localStorage.getItem("site.lang") || null;

        // helpers
        function normLang(nav) {
          nav = String(nav || "en").toLowerCase();
          var base = nav.split("-")[0];
          if (base === "pt" && /-mz$/i.test(nav)) base = "ptmz";
          if (base === "pt-pt" || base === "pt-br") base = "pt";
          if (SUPPORTED.indexOf(base) === -1) base = "en";
          return base;
        }
        function inferCurrency(langNow) {
          var list = (navigator.languages && navigator.languages.length)
            ? navigator.languages
            : [navigator.language].filter(Boolean);

          var HINT = {
            "de": "EUR", "nl": "EUR", "fr": "EUR", "it": "EUR", "es": "EUR", "pt": "EUR",
            "en-gb": "GBP", "en-us": "USD", "en-za": "ZAR"
          };
          var first = (list[0] || "").toLowerCase();

          var region = null;
          for (var i = 0; i < list.length; i++) {
            var s = String(list[i] || "").toUpperCase();
            var m = s.match(/-([A-Z]{2})$/);
            if (m) { region = m[1]; break; }
          }
          if (!region) {
            try {
              var intl = new Intl.DateTimeFormat().resolvedOptions().locale || "";
              var m2 = String(intl).toUpperCase().match(/-([A-Z]{2})$/);
              if (m2) region = m2[1];
            } catch (e) { }
          }

          var CC2CUR = {
            US: "USD", GB: "GBP",
            NL: "EUR", BE: "EUR", FR: "EUR", DE: "EUR", IT: "EUR", ES: "EUR", PT: "EUR", IE: "EUR", AT: "EUR", FI: "EUR", GR: "EUR",
            ZA: "ZAR", MZ: "MZN"
          };

          var cur = HINT[first] ||
            (region && CC2CUR[region]) ||
            (langNow === "ptmz" ? "MZN" : "USD");

          cur = String(cur || "USD").toUpperCase().replace(/[^A-Z]/g, "").slice(0, 3);
          return cur || "USD";
        }

        // ensure lang_source exists
        if (!localStorage.getItem("site.lang_source")) {
          localStorage.setItem("site.lang_source", "auto");
          src = "auto";
        }

        if (src === "auto") {
          // always recompute on AUTO
          var navLang = normLang(navigator.language);
          localStorage.setItem("site.lang", navLang);
          localStorage.setItem("site.currency", inferCurrency(navLang));
          lang = navLang;
          curr = localStorage.getItem("site.currency");
        } else {
          // USER: only backfill if missing
          if (!lang) {
            lang = normLang(navigator.language);
            localStorage.setItem("site.lang", lang);
          }
          if (!curr) {
            curr = inferCurrency(lang);
            localStorage.setItem("site.currency", curr);
          }
        }

        // reflect on <html>
        document.documentElement.setAttribute("lang", lang || "en");
      } catch (e) { }
    })();
  </script>

  <!-- Global locale setter -->
  <script>
    (function () {
      if (window.setSiteLocale) return;

      function normLang(s) {
        s = String(s || '').toLowerCase().replace('_', '-');
        if (s === 'pt-mz') s = 'ptmz';
        if (s === 'pt-pt' || s === 'pt-br') s = 'pt';
        if (/^[a-z]{2}-[a-z]{2}$/.test(s)) s = s.slice(0, 2);
        return s || 'en';
      }
      function clampCur(c) {
        if (!c) return null;
        c = String(c).toUpperCase().replace(/[^A-Z]/g, '');
        return c.length === 3 ? c : null;
      }
      function setPrefCookies(lang, currency) {
        var host = location.hostname;
        var isLocal = (host === "localhost") || (host === "127.0.0.1") || /^\d+\.\d+\.\d+\.\d+$/.test(host);
        var domainPart = isLocal ? "" : ";domain=.devoceanlodge.com";
        var securePart = location.protocol === "https:" ? ";Secure" : "";
        var base = ";max-age=31536000;path=/;SameSite=Lax" + domainPart + securePart;
        if (lang) document.cookie = "lang=" + lang + base;
        if (currency) document.cookie = "currency=" + currency + base;
      }

      window.setSiteLocale = function setSiteLocale({ lang, currency } = {}) {
        const L = lang ? normLang(lang) : (localStorage.getItem('site.lang') || 'en');
        const C = currency ? clampCur(currency) : (localStorage.getItem('site.currency') || 'USD');

        try {
          localStorage.setItem('site.lang', L);
          localStorage.setItem('site.currency', C || 'USD');
          localStorage.setItem('site.lang_source', 'user');
          document.documentElement.setAttribute('lang', L);
        } catch { }

        setPrefCookies(L, C || 'USD');
      };
    })();
  </script>
</head>

<body>
  <!-- GTM (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-532W3HH2" height="0" width="0"
      style="display:none;visibility:hidden"></iframe>
  </noscript>

  <!-- DEV entry (Vite) -->
  <script type="module" src="/src/main.jsx"></script>

  <div id="root">
    <!-- SEO: H1 for crawlers before React hydrates -->
    <h1 style="position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;">DEVOCEAN Lodge - Eco-friendly Beach Accommodation in Ponta do Ouro, Mozambique</h1>
  </div>
</body>

</html>
