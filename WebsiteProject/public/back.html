<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Returning to DEVOCEAN Lodge...</title>

  <!-- Consent Mode v2 Defaults (MUST be FIRST script) -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    // EU+UK = denied by default
    gtag('consent', 'default', {
      ad_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      analytics_storage: 'denied',
      functionality_storage: 'granted',
      personalization_storage: 'granted',
      security_storage: 'granted',
      region: [
        'AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT',
        'LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','IS','LI','NO','GB'
      ]
    });

    // Everywhere else = granted
    gtag('consent', 'default', {
      ad_storage: 'granted',
      ad_user_data: 'granted',
      ad_personalization: 'granted',
      analytics_storage: 'granted',
      functionality_storage: 'granted',
      personalization_storage: 'granted',
      security_storage: 'granted'
    });
  </script>

  <!-- Google Tag Manager (Delayed Load for PageSpeed) -->
  <script>
    (function() {
      var gtmLoaded = false;
      function loadGTM() {
        if (gtmLoaded) return;
        gtmLoaded = true;
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-532W3HH2');
      }
      // Load after 3 seconds
      setTimeout(loadGTM, 3000);
      // Or load on first user interaction
      ['scroll','mousemove','touchstart','click'].forEach(function(e){
        window.addEventListener(e, loadGTM, {once: true, passive: true});
      });
    })();
  </script>
  <!-- End Google Tag Manager -->

  <!-- Start cookieyes banner -->
  <script id="cookieyes" type="text/javascript" src="https://cdn-cookieyes.com/client_data/f0a2da84090ecaa3b37f74af/script.js" defer></script>
  <!-- End cookieyes banner -->

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a4d68 0%, #088395 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      text-align: center;
      padding: 2rem;
    }
    .logo {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .message {
      font-size: 1.125rem;
      opacity: 0.9;
    }
    .spinner {
      width: 40px;
      height: 40px;
      margin: 2rem auto;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-532W3HH2"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="container">
    <div class="logo">DEVOCEAN Lodge</div>
    <div class="spinner"></div>
    <div class="message">Taking you back...</div>
  </div>

  <script>
    (function() {
      // Try to get return_url from current page URL first (if Hotelrunner supports passing it)
      const urlParams = new URLSearchParams(window.location.search);
      const returnUrl = urlParams.get('return_url');
      
      if (returnUrl) {
        // If we have a return_url parameter, use it directly
        window.location.href = decodeURIComponent(returnUrl);
        return;
      }
      
      // Otherwise, try to extract language/currency from referrer
      const referrer = document.referrer;
      let targetUrl = 'https://devoceanlodge.com/';
      
      if (referrer && referrer.includes('devoceanlodge.com')) {
        // Parse the referrer URL to extract lang/currency parameters
        try {
          const refUrl = new URL(referrer);
          const refParams = new URLSearchParams(refUrl.search);
          const lang = refParams.get('lang');
          const currency = refParams.get('currency');
          
          // Also check hash parameters (for #stay?lang=ja&currency=JPY)
          if (!lang && refUrl.hash) {
            const hashMatch = refUrl.hash.match(/[?&]lang=([^&]+)/);
            const currencyMatch = refUrl.hash.match(/[?&]currency=([^&]+)/);
            
            if (hashMatch && currencyMatch) {
              targetUrl = `https://devoceanlodge.com/?lang=${hashMatch[1]}&currency=${currencyMatch[1]}`;
            }
          } else if (lang && currency) {
            targetUrl = `https://devoceanlodge.com/?lang=${lang}&currency=${currency}`;
          }
        } catch (e) {
          // If parsing fails, just go to homepage
          console.error('Error parsing referrer:', e);
        }
      }
      
      // Redirect after a brief moment for visual feedback
      setTimeout(function() {
        window.location.href = targetUrl;
      }, 300);
    })();
  </script>
</body>
</html>
